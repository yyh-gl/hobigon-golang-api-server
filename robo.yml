variables:
  work_dir: ~/workspaces/Go/src/github.com/yyh-gl/hobigon-golang-api-server
  git:
    commit: $(git rev-parse HEAD)
    branch: $(git rev-parse --abbrev-ref HEAD)

api-build-local:
  summary: |
    APIã‚µãƒ¼ãƒã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã¤Linuxç”¨ã«ãƒ“ãƒ«ãƒ‰
      -> å¼•æ•°ã‚’ã²ã¨ã¤æ¸¡ã™ã“ã¨ãŒå¯èƒ½ï¼ˆ-xï¼šãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã‚’å‡ºåŠ›ï¼‰
  command: GO111MODULE=on GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build $1 -ldflags "-X main.COMMIT={{.git.commit}} -X main.BRANCH={{.git.branch}}" -o ./docker/api/bin/api-server ./cmd/api/main.go

api-build-prod:
  summary: |
    APIã‚µãƒ¼ãƒã‚’Productionã‹ã¤Linuxç”¨ã«ãƒ“ãƒ«ãƒ‰
      -> å¼•æ•°ã‚’ã²ã¨ã¤æ¸¡ã™ã“ã¨ãŒå¯èƒ½ï¼ˆ-xï¼šãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã‚’å‡ºåŠ›ï¼‰
  command: GO111MODULE=on GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build $1 -ldflags "-X main.COMMIT={{.git.commit}} -X main.BRANCH={{.git.branch}}" -o ./cmd/api/bin/api-server ./cmd/api/main.go

deploy:
  summary: Productionã‹ã¤Linuxç”¨ã«ãƒ“ãƒ«ãƒ‰ã—ã¦ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆmasterã«PUSHï¼‰
  command: |
    robo api-build-prod
    git add ./cmd/api/bin/api-server
    git commit -m "[`date +'%Y/%m/%d %H:%M:%S'`] æœ€æ–°ç‰ˆãƒ‡ãƒ—ãƒ­ã‚¤"
    git push origin master

lint:
  summary: DockerçµŒç”±ã§Lintå®Ÿè¡Œ
  command: docker-compose exec -T api golangci-lint run --tests --disable-all --enable=goimports --enable=golint --enable=govet --enable=errcheck ./...

get-access-ranking:
  summary: ã‚¢ã‚¯ã‚»ã‚¹ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—
  command: |
    echo "robo ã‚¿ã‚¹ã‚¯æœªå¯¾å¿œï¼ˆç¾åœ¨ã€å®Ÿè£…ä¸­ğŸš§ï¼‰"
